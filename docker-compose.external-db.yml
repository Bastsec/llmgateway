name: llmgateway-external-db

services:
  llmgateway:
    build:
      context: .
      dockerfile: infra/unified.coolify.dockerfile
      args:
        APP_VERSION: ${APP_VERSION:-prod}
    container_name: llmgateway-external-db
    restart: unless-stopped
    ports:
      - "3002:3002" # UI
      - "3003:3003" # Playground
      - "3005:3005" # Docs
      - "4001:4001" # Gateway
      - "4002:4002" # API
      - "6379:6379" # Redis (internal)
    volumes:
      - llmgateway_redis:/var/lib/redis
    environment:
      # Database
      DATABASE_URL: ${DATABASE_URL}
      # Redis (internal bundled)
      REDIS_HOST: localhost
      REDIS_PORT: "6379"
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      # URLs
      UI_URL: ${UI_URL}
      PLAYGROUND_URL: ${PLAYGROUND_URL}
      API_URL: ${API_URL}
      API_BACKEND_URL: ${API_BACKEND_URL}
      ORIGIN_URLS: ${ORIGIN_URLS}
      COOKIE_DOMAIN: ${COOKIE_DOMAIN}
      # Authentication
      PASSKEY_RP_ID: ${PASSKEY_RP_ID}
      PASSKEY_RP_NAME: ${PASSKEY_RP_NAME}
      AUTH_SECRET: ${AUTH_SECRET}
      GITHUB_CLIENT_ID: ${GITHUB_CLIENT_ID}
      GITHUB_CLIENT_SECRET: ${GITHUB_CLIENT_SECRET}
      # Analytics (optional)
      POSTHOG_KEY: ${POSTHOG_KEY}
      POSTHOG_HOST: ${POSTHOG_HOST}
      # Paystack (payments)
      PAYSTACK_SECRET_KEY: ${PAYSTACK_SECRET_KEY}
      PAYSTACK_PUBLIC_KEY: ${PAYSTACK_PUBLIC_KEY}
      PAYSTACK_WEBHOOK_SECRET: ${PAYSTACK_WEBHOOK_SECRET}
      PAYSTACK_API_URL: ${PAYSTACK_API_URL}
      # LLM Provider API Keys
      LLM_OPENAI_API_KEY: ${LLM_OPENAI_API_KEY}
      LLM_ANTHROPIC_API_KEY: ${LLM_ANTHROPIC_API_KEY}
      # Azure OpenAI
      LLM_AZURE_API_KEY: ${LLM_AZURE_API_KEY}
      LLM_AZURE_RESOURCE: ${LLM_AZURE_RESOURCE}
      LLM_AZURE_API_VERSION: ${LLM_AZURE_API_VERSION}
      LLM_AZURE_DEPLOYMENT_TYPE: ${LLM_AZURE_DEPLOYMENT_TYPE}
      # Migrations
      RUN_MIGRATIONS: "true"

volumes:
  llmgateway_redis:
    driver: local
